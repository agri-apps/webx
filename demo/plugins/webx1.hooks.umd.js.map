{"version":3,"file":"webx1.hooks.umd.js","sources":["../../src/utils/rules.js","../../src/plugins/withHooks.js"],"sourcesContent":["const rules = {\n    isString: (o) => {\n      return o !== null && typeof o === \"string\";\n    },\n    isEmptyObject: (o) => {\n      var name;\n      for (name in o) {\n        if (o.hasOwnProperty(name)) return false;\n      }\n      return true;\n    },\n    isFunc: (o) => {\n      return typeof o === \"function\";\n    },\n    isAsyncFunc: (fn) => {\n      return rules.isFunc(fn) && fn.constructor.name === \"AsyncFunction\";\n    },\n    isNode: (o) => {\n      return typeof Node === \"object\"\n        ? o instanceof Node\n        : o &&\n            typeof o === \"object\" &&\n            typeof o.nodeType === \"number\" &&\n            typeof o.nodeName === \"string\";\n    },\n    isElement: (o) => {\n      return typeof HTMLElement === \"object\"\n        ? o instanceof HTMLElement //DOM2\n        : o &&\n            typeof o === \"object\" &&\n            o !== null &&\n            o.nodeType === 1 &&\n            typeof o.nodeName === \"string\";\n    },\n  };\n\n  export default rules;","import rules from \"./../utils/rules\";\n\nexport default (app, options = {}) => {\n  app.hooks = app.hooks || {};\n  app.hooks.preRender = [];\n  app.hooks.preRoute = [];\n  app.hooks.preState = [];\n\n  Object.keys(app.hooks).forEach(key => {\n      let hook = options[key];\n      if (hook && rules.isFunc(hook)) {\n        app.hooks[key].push(hook);\n      }\n  })\n\n  const appProxy = {\n    setState: app.setState,\n    getState: app.getState,\n    refresh: app.refresh,\n  };\n\n  const applyHook = (name, state) => {\n    if (app.debug) {\n      console.log('applying hook', hook, state);\n    }\n    if (!app.hooks[name]) {\n      return state;\n    }\n    let hookState = app.hooks[name].reduce(\n      (prev, curr) => {\n        prev = curr(prev);\n        return prev;\n      },\n      { ...state }\n    );\n    return hookState;\n  };\n\n  // preState hook\n  let appSetState = app.setState;\n\n  app.setState = (key, value) => {\n    let preState = applyHook(\"preState\", { key, value });\n    return appSetState.call(app, preState.key, preState.value);\n  };\n\n  // preRoute hook\n  let appNavigate = app.navigate;\n  let appRenderView = app.renderView;\n\n  app.navigate = async (pathName, force) => {\n    let preRoute = applyHook(\"preRoute\", {\n      pathName,\n      state: { ...app.getState() },\n    });\n    // Redirects\n    if (preRoute.redirect) {\n      return await appNavigate.call(app, preRoute.redirect, true);\n    }\n    // Custom routes\n    if (preRoute.route) {\n      if (preRoute.route.init && rules.isFunc(preRoute.route.init)) {\n        preRoute.route.init(preRoute.state, app.proxy, app.el);\n      }\n\n      return await appRenderView.call(app, preRoute.route.view, preRoute.state);\n    }\n    return await appNavigate(preRoute.pathName, force);\n  };\n\n  // preRender hook\n  app.renderView = async (view, state = {}, meta = {}) => {\n\n    let preRender = applyHook(\"preRender\", { view, state: {...state}, meta });\n\n    return await appRenderView.call(app, preRender.view, preRender.state, preRender.meta);\n  };\n\n  if (options.install && rules.isFunc(options.install)) {\n    options.install();\n  }\n\n  return app;\n};\n"],"names":["rules","isString","o","isEmptyObject","name","hasOwnProperty","isFunc","isAsyncFunc","fn","constructor","isNode","Node","nodeType","nodeName","isElement","HTMLElement","app","options","hooks","preRender","preRoute","preState","Object","keys","forEach","key","hook","push","applyHook","state","debug","console","log","reduce","prev","curr","appSetState","setState","value","call","appNavigate","navigate","appRenderView","renderView","pathName","force","route","init","proxy","el","_exit2","view","getState","redirect","meta","install"],"mappings":"kYAAA,IAAMA,EAAQ,CACVC,SAAU,SAACC,GACT,OAAa,OAANA,GAA2B,iBAANA,GAE9BC,cAAe,SAACD,GACd,IAAIE,EACJ,IAAKA,KAAQF,EACX,GAAIA,EAAEG,eAAeD,GAAO,SAE9B,UAEFE,OAAQ,SAACJ,GACP,MAAoB,mBAANA,GAEhBK,YAAa,SAACC,GACZ,OAAOR,EAAMM,OAAOE,IAA+B,kBAAxBA,EAAGC,YAAYL,MAE5CM,OAAQ,SAACR,GACP,MAAuB,iBAATS,KACVT,aAAaS,KACbT,GACe,iBAANA,GACe,iBAAfA,EAAEU,UACa,iBAAfV,EAAEW,UAEjBC,UAAW,SAACZ,GACV,MAA8B,iBAAhBa,YACVb,aAAaa,YACbb,GACe,iBAANA,GACD,OAANA,GACe,IAAfA,EAAEU,UACoB,iBAAfV,EAAEW,2BC9BLG,EAAKC,YAAAA,IAAAA,EAAU,IAC7BD,EAAIE,MAAQF,EAAIE,OAAS,GACzBF,EAAIE,MAAMC,UAAY,GACtBH,EAAIE,MAAME,SAAW,GACrBJ,EAAIE,MAAMG,SAAW,GAErBC,OAAOC,KAAKP,EAAIE,OAAOM,QAAQ,SAAAC,GAC3B,IAAIC,EAAOT,EAAQQ,GACfC,GAAQ1B,EAAMM,OAAOoB,IACvBV,EAAIE,MAAMO,GAAKE,KAAKD,KAU1B,IAAME,EAAY,SAACxB,EAAMyB,GAIvB,OAHIb,EAAIc,OACNC,QAAQC,IAAI,gBAAiBN,KAAMG,GAEhCb,EAAIE,MAAMd,GAGCY,EAAIE,MAAMd,GAAM6B,OAC9B,SAACC,EAAMC,GAEL,OADOA,EAAKD,SAGTL,IAPEA,GAaPO,EAAcpB,EAAIqB,SAEtBrB,EAAIqB,SAAW,SAACZ,EAAKa,GACnB,IAAIjB,EAAWO,EAAU,WAAY,CAAEH,IAAAA,EAAKa,MAAAA,IAC5C,OAAOF,EAAYG,KAAKvB,EAAKK,EAASI,IAAKJ,EAASiB,QAItD,IAAIE,EAAcxB,EAAIyB,SAClBC,EAAgB1B,EAAI2B,WAkCxB,OAhCA3B,EAAIyB,kBAAkBG,EAAUC,wFAiBjBL,EAAYpB,EAASwB,SAAUC,wBAPxCzB,EAAS0B,aACP1B,EAAS0B,MAAMC,MAAQ/C,EAAMM,OAAOc,EAAS0B,MAAMC,OACrD3B,EAAS0B,MAAMC,KAAK3B,EAASS,MAAOb,EAAIgC,MAAOhC,EAAIiC,IAZfC,oBAezBR,EAAcH,KAAKvB,EAAKI,EAAS0B,MAAMK,KAAM/B,EAASS,4CAdjET,EAAWQ,EAAU,WAAY,CACnCgB,SAAAA,EACAf,WAAYb,EAAIoC,8BAGdhC,EAASiC,oCACEb,EAAYD,KAAKvB,EAAKI,EAASiC,UAAU,wDAP1D,oCAqBArC,EAAI2B,oBAAoBQ,EAAMtB,EAAYyB,YAAZzB,IAAAA,EAAQ,aAAIyB,IAAAA,EAAO,QAE/C,IAAInC,EAAYS,EAAU,YAAa,CAAEuB,KAAAA,EAAMtB,WAAWA,GAAQyB,KAAAA,IAFZ,uBAIzCZ,EAAcH,KAAKvB,EAAKG,EAAUgC,KAAMhC,EAAUU,MAAOV,EAAUmC,OAJlF,oCAOIrC,EAAQsC,SAAWvD,EAAMM,OAAOW,EAAQsC,UAC1CtC,EAAQsC,UAGHvC"}