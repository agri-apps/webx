{"version":3,"file":"webx1.umd.js","sources":["../src/utils/rules.js","../src/index.js"],"sourcesContent":["const rules = {\n    isArray: (o) => {\n        return Array.isArray(o);\n    },\n    isString: (o) => {\n      return o !== null && typeof o === \"string\";\n    },\n    isEmptyObject: (o) => {\n      var name;\n      for (name in o) {\n        if (o.hasOwnProperty(name)) return false;\n      }\n      return true;\n    },\n    isFunc: (o) => {\n      return typeof o === \"function\";\n    },\n    isAsyncFunc: (fn) => {\n      return rules.isFunc(fn) && fn.constructor.name === \"AsyncFunction\";\n    },\n    isNode: (o) => {\n      return typeof Node === \"object\"\n        ? o instanceof Node\n        : o &&\n            typeof o === \"object\" &&\n            typeof o.nodeType === \"number\" &&\n            typeof o.nodeName === \"string\";\n    },\n    isElement: (o) => {\n      return typeof HTMLElement === \"object\"\n        ? o instanceof HTMLElement //DOM2\n        : o &&\n            typeof o === \"object\" &&\n            o !== null &&\n            o.nodeType === 1 &&\n            typeof o.nodeName === \"string\";\n    },\n  };\n\n  export default rules;","import rules from \"./utils/rules\";\n\nconst defaultOptions = {\n  global: \"$\",\n  appName: \"App\",\n  metaTitlePrepend: \"\",\n  routes: {},\n  notFoundRouteName: \"notfound\",\n  notFoundUrl: \"/notfound\",\n};\n\nexport default async (options) => {\n  let opts = Object.assign({}, defaultOptions, options);\n\n  let cache = {\n    views: {},\n    _routes: {},\n    routes: {\n      \"/\": () => ({\n        view: `<div>Webx Rocks!</div>`,\n      }),\n      [\"/notfound\"]: () => ({\n        view: `<div>404 Not Found!</div>`,\n      }),\n      [\"/error\"]: () => ({\n        view: \"<div>An error has occurred!</div>\",\n      }),\n    },\n  };\n\n  // routes  \n  // if (!rules.isEmptyObject(opts.routes)) {\n  //   // prevalidate routes\n  //   let routeErrors = {};\n  //   for (var x in opts.routes) {\n  //     if (opts.routes.hasOwnProperty(x)) {\n  //       let route = opts.routes[x];        \n  //       if (rules.isFunc(route)) {\n  //         route = await route() || { view: () => `<div>???</div>`, name: 'missing' }\n  //         // default export check\n  //         if (!route.view) {\n  //           if (route.default) {\n  //             route = route.default;\n  //           }\n  //         }\n  //       }\n  //       if (!route.view) {\n  //         routeErrors[x] = [`A view property is required for route \"${x}\"`];\n  //       }\n  //     }\n  //   }\n  //   if (Object.keys(routeErrors).length) {\n  //     if (opts.debug) {\n  //       Object.values(routeErrors).forEach(val => console.error(val));\n  //     }\n  //     throw new Error(\"Invalid route configuration\", routeErrors);\n  //   }    \n  //}\n  cache.routes = Object.assign({}, cache.routes, opts.routes);\n\n  const getRoute = async route => {\n    if (opts.debug) {\n      console.log(`Resolving route`, route, rules.isString(route));\n    }\n    let rt = route;\n    if (rules.isString(route)) {\n      if (cache._routes[route]) {\n        opts.debug ? console.log(`${route} resolved from cache.`) : null;\n        return cache._routes[route];\n      }\n\n      rt = cache.routes[route];\n    }\n\n    if (!rules.isFunc(rt)) {\n      cache._routes[route] = rt;\n      return rt;\n    }\n\n    let current = await rt();\n\n    if (!current) {\n      return null;\n    }\n\n    if (current.default) {\n      cache._routes\n    }\n\n    cache._routes[route] = current.default ? current.default : current;\n    return cache._routes[route];\n  }\n\n  const getProxy = (app) => {\n    let builtins = {\n      setState: app.setState,\n      getState: app.getState,\n      dispatch: app.dispatch,\n      listen: app.listen,\n      refresh: app.refresh,\n    };\n\n    // Add plugin api's to proxy\n    return Object.keys(app._plugins).reduce((prev, next) => {\n      let plugin = app._plugins[next];\n      if (plugin.api) {\n        let ref = plugin.namespace ? plugin.namespace : plugin.name;\n        if (!prev[ref]) {\n          prev[ref] = plugin.api;\n        } else {\n          prev[ref] = Object.assign(prev[ref], plugin.api);\n        }\n      }\n      return prev;\n    }, builtins);\n  };\n\n  const app = {\n    el: document.body,\n    _currentPath: null,\n    _currentRoute: null,\n    _state: {},\n    _listeners: [],\n    _plugins: {},\n    routes: { ...cache.routes },\n    ok: true,\n    plugin: (plugin, options = {}) => {\n      if (!plugin.name) {\n        throw new Error(\"A plugin must have a name property.\");\n      }\n      if (!plugin.install || !rules.isFunc(plugin.install)) {\n        throw new Error(\"A plugin must define an install method.\");\n      }\n      if (app._plugins[plugin.name]) {\n        throw new Error(\n          `A plugin with the name: \"${plugin.name} is already registered.\"`\n        );\n      }\n      app._plugins[plugin.name] = plugin;\n      try {\n        let api = plugin.install(app, options);\n        opts.debug ? console.log(`Plugin \"${plugin.name}\" installed.`) : null\n        if (api) {\n          app._plugins[plugin.name].api = api;\n          // Add to window global\n          if (plugin.global) {\n            if (!window[plugin.global]) {\n              window[plugin.global] = api;\n            } else {\n              window[plugin.global] = Object.assign(window[plugin.global], api);\n            }\n          }\n          // Update app context\n          app.ctx = getProxy(app);\n        }\n        if (options.installed && rules.isFunc(options.installed)) {\n          options.installed();\n        }\n      } catch (err) {\n        console.error(`Plugin \"${plugin.name}\" failed to install.`, err);\n        if (options.onError && rules.isFunc(options.onError)) {\n          options.onError(err);\n        }\n        delete app._plugins[plugin.name];\n      }\n    },\n    getRoute,\n    getState: (...args) => {\n      if (args.length) {\n        return app._state[args[0]];\n      }\n      return { ...app._state };\n    },\n    setState: (key, value) => {\n      let oldState = Object.freeze(JSON.parse(JSON.stringify(app._state)));\n      app._state[key] = value;\n      let newState = Object.freeze(JSON.parse(JSON.stringify(app._state)));\n      // change listeners\n      app._listeners.forEach((listener) => {\n        listener(\"stateChange\", newState, oldState, key, value);\n      });\n    },\n    replaceState: (newState) => {\n      let oldState = Object.freeze(JSON.parse(JSON.stringify(app._state)));\n      app._state = newState;\n      app._listeners.forEach((listener) => {\n        listener(\"stateChange\", newState, oldState, \"*\", newState);\n      });\n    },\n    dispatch: (type, ...args) => {\n      app._listeners.forEach((listener) => {\n        listener.apply(null, [type, ...args]);\n      });\n    },\n    listen: (handler) => {\n      if (rules.isFunc(handler)) {\n        app._listeners.push(handler);\n        return () => {\n          let idx = app._listeners.indexOf(handler);\n          if (idx !== -1) {\n            app._listeners.splice(idx, 1);\n          }\n        };\n      } else {\n        console.error(\"Listen handler must be a function\", handler);\n      }\n    },\n    refresh: () => {\n      app.navigate(app._currentPath, true, true)\n        .then(() => app.dispatch('refreshed', app._currentPath))      \n    },\n    renderView: async (view, state, meta) => {\n      let customRender = app.el.renderView && rules.isFunc(app.el.renderView);\n\n      // Non function views\n      if (!rules.isFunc(view)) {\n        if (customRender) {\n          app.el.renderView(view, state, meta);\n        } else {\n          app.el.innerHTML = `${view}`;\n        }\n        app.dispatch('view-rendered', { detail: { view, meta } });\n        return;\n      }\n\n      if (!rules.isFunc(view)) {\n        throw new Error(\"renderView requires a function.\");\n      }\n\n      if (customRender) {\n        try {\n          await app.el.renderView(view, state, meta);\n        } catch (err) {\n          console.error(\"render async view error\", err);\n          app.dispatch('view-render-failed', { detail: view, error: err });\n        }\n        return;\n      }\n\n      try {\n        app.el.innerHTML = await view(state);\n      } catch (err) {\n        console.error(\"Render view errror\", err);\n        app.dispatch('view-render-failed', { detail: view, error: err });\n      }\n\n      if (meta) {\n        document.title = `${opts.metaTitlePrepend}${meta.title}`;\n      }\n\n      app.dispatch('view-rendered', { detail: { view, meta } });\n    },\n    initRoute: async (route, state) => {\n      const proxy = getProxy(app);\n      let rt = await getRoute(route);\n\n      if (rules.isFunc(rt.init)) {\n        await rt.init(state, proxy, app.el);\n      }\n    },\n    unmountRoute: async (route) => {\n      let rt = await getRoute(route);\n      if (rt && rules.isFunc(rt.unmount)) {\n        rt.unmount(getProxy(app));\n      }\n    },\n    routeInit: async (route, state) => {\n      let rt = await getRoute(route);\n      if (opts.routeInit && rules.isFunc(opts.routeInit)) {\n        await opts.routeInit(rt, state);\n      }\n    },\n    navigate: async (pathName, force, refreshOnly) => {\n      // don't fire same route unless forced\n      if (!force && app._currentPath && app._currentPath === pathName) {\n        return false;\n      }\n      const prevPath = app._currentPath;\n      app._currentPath = pathName;\n      let query = {};\n      let params = {};\n\n      const setRoute = async (path, xtra = {}) => {\n        let route = await getRoute(path);\n\n        if (route === null) {\n          route = routes[\"/notfound\"] || {\n            view: () => `<div class=\"page\">404 Not Found</div>`,\n          };\n        }\n\n        app._currentRoute = path;\n\n        query = location.search\n          .slice(1)\n          .split(\"&\")\n          .reduce((prev, curr) => {\n            let t = curr.split(\"=\");\n            prev[t[0]] = decodeURIComponent(t[1] || \"\");\n            return prev;\n          }, {});\n        let state = { ...app.getState(), ...xtra, query, path };\n\n        // Pre-render hook\n        if (!refreshOnly) {\n          try {\n            let routeState = await app.routeInit(route, state);\n            if (routeState && !rules.isEmptyObject(routeState)) {\n              state = {...state, routeState};\n            }\n          } catch (err) {\n            console.error(\"Pre-render failed:\", err);\n          }\n        }\n\n        // Render view\n        try {\n          await app.renderView(route.view, state, route.meta);\n        } catch (err) {\n          console.error(\"Render view failed\", err);\n        }\n\n        // Initialize route\n        try {\n          await app.initRoute(route, state);\n        } catch (err) {\n          console.error(\n            `Init route for \"${route.name ? route.name : path}\" failed`,\n            err\n          );\n        }\n\n        const { params = {} } = xtra;\n\n        if (!refreshOnly) {\n          app._listeners.forEach((listener) => {\n            listener(\"pageChange\", {\n              from: prevPath,\n              to: app._currentRoute,\n              params,\n              query,\n            });\n          });\n        }\n      };\n\n      //const { routes } = app;\n\n      // Unmount current route, if any\n      if (!refreshOnly) {\n        if (app._currentRoute) {\n          app.unmountRoute(await getRoute(app._currentRoute));\n        }\n      }\n\n      // exact match\n      if (await getRoute(pathName)) {\n        app._currentRoute = pathName;\n        await setRoute(pathName);\n        return { path: pathName, route: pathName, query, params };\n      }\n\n      // param route w/fuzzy match logic\n      let tokens = pathName.split(\"/\").slice(1);\n      let found = Object.keys(cache.routes).filter((x) => {\n        return (\n          x.indexOf(`/${tokens[0]}`) !== -1 &&\n          x.split(\"/\").slice(1).length === tokens.length\n        );\n      })[0];\n\n      if (found) {\n        found\n          .split(\"/\")\n          .slice(2)\n          .forEach((n, x) => {\n            params[n.slice(1)] = tokens[x + 1];\n          });\n        await setRoute(found, { params });\n        return { path: pathName, route: found, query, params };\n      }\n      // Not found\n      app._currentRoute = opts.notFoundRouteName;\n      await setRoute(opts.notFoundUrl);\n      return { path: pathName, route: undefined, query, params };\n    },\n    boot: async () => {\n      // Runs on startup. Intended to be monkey patched in plugins.\n    },\n  };\n\n  const mount = async (el) => {\n    try {\n      if (rules.isString(el)) {\n        app.el = document.querySelector(el);\n        if (!app.el) {\n          throw new Error(`Invalid mount target: ${el}. Missing from the DOM.`);\n        }\n      } else {\n        if (!rules.isNode(el) || !rules.isElement(el)) {\n          throw new Error(\"Invalid DOM object for mount.\");\n        }\n        app.el = el;\n      }\n\n      if (rules.isFunc(opts.init)) {\n        // try to just invoke function;\n        app._state = await opts.init();\n      } else {\n        app._state = opts.init || {};\n      }\n\n      if (opts.debug) {\n        console.log(\"Initial app state\", app._state);\n      }\n\n      window.onpopstate = async () => {\n        await app.navigate(window.location.pathname);\n      };\n\n      app.global = opts.global;\n      window[opts.global] = window[opts.global] || {};\n\n      window[opts.global].navigate = async (pathName) => {\n        window.history.pushState(\n          {},\n          pathName,\n          window.location.origin + pathName\n        );\n        await app.navigate(pathName);\n      };\n\n      window[opts.global].dispatch = app.dispatch.bind(app);\n\n      await app.boot();\n\n      await app.navigate(window.location.pathname);\n\n      return app;\n    } catch (e) {\n      return { ok: false, error: e };\n    }\n  };\n\n  app.el = opts.node || document.body;\n\n  // Expects plugins in array format plugins: [[plugin1, options1], [plugin2, options2]]\n  if (opts.plugins && rules.isArray(opts.plugins)) {\n    opts.plugins.forEach((plugin) => {\n      app.plugin(plugin[0], plugin.length > 1 ? plugin[1] : {});\n    });\n  }\n\n  // set the app context\n  app.ctx = getProxy(app);\n\n  if (opts.node && (rules.isElement(opts.node) || rules.isNode(opts.node))) {\n    return mount(opts.node);\n  }\n\n  return mount(document.body);\n};\n"],"names":["rules","isArray","o","Array","isString","isEmptyObject","name","hasOwnProperty","isFunc","isAsyncFunc","fn","constructor","isNode","Node","nodeType","nodeName","isElement","HTMLElement","_catch","body","recover","result","e","then","defaultOptions","global","appName","metaTitlePrepend","routes","notFoundRouteName","notFoundUrl","options","opts","Object","assign","cache","views","_routes","/","view","getRoute","route","debug","console","log","rt","current","getProxy","app","builtins","setState","getState","dispatch","listen","refresh","keys","_plugins","reduce","prev","next","plugin","api","ref","namespace","el","document","_currentPath","_currentRoute","_state","_listeners","ok","Error","install","window","ctx","installed","err","error","onError","args","length","key","value","oldState","freeze","JSON","parse","stringify","newState","forEach","listener","replaceState","type","apply","handler","push","idx","indexOf","splice","navigate","renderView","state","meta","title","detail","innerHTML","customRender","initRoute","proxy","init","unmountRoute","unmount","routeInit","pathName","force","refreshOnly","setRoute","path","undefined","query","params","tokens","split","slice","found","filter","x","n","prevPath","xtra","from","to","location","search","curr","t","decodeURIComponent","routeState","_unmountRoute2","boot","mount","onpopstate","pathname","history","pushState","origin","bind","querySelector","node","plugins"],"mappings":"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"}