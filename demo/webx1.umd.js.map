{"version":3,"file":"webx1.umd.js","sources":["../src/utils/rules.js","../src/index.js"],"sourcesContent":["const rules = {\n    isString: (o) => {\n      return o !== null && typeof o === \"string\";\n    },\n    isEmptyObject: (o) => {\n      var name;\n      for (name in o) {\n        if (o.hasOwnProperty(name)) return false;\n      }\n      return true;\n    },\n    isFunc: (o) => {\n      return typeof o === \"function\";\n    },\n    isAsyncFunc: (fn) => {\n      return rules.isFunc(fn) && fn.constructor.name === \"AsyncFunction\";\n    },\n    isNode: (o) => {\n      return typeof Node === \"object\"\n        ? o instanceof Node\n        : o &&\n            typeof o === \"object\" &&\n            typeof o.nodeType === \"number\" &&\n            typeof o.nodeName === \"string\";\n    },\n    isElement: (o) => {\n      return typeof HTMLElement === \"object\"\n        ? o instanceof HTMLElement //DOM2\n        : o &&\n            typeof o === \"object\" &&\n            o !== null &&\n            o.nodeType === 1 &&\n            typeof o.nodeName === \"string\";\n    },\n  };\n\n  export default rules;","import rules from \"./utils/rules\";\n\nconst defaultOptions = {\n  global: \"$\",\n  appName: \"App\",\n  metaTitlePrepend: \"\",\n  routes: {},\n  notFoundRouteName: \"notfound\",\n  notFoundUrl: \"/notfound\",\n};\n\nexport default async (options) => {\n  let opts = Object.assign({}, defaultOptions, options);\n\n  let cache = {\n    routes: {\n      \"/\": () => ({\n        view: `<div>Webx Rocks!</div>`,\n      }),\n      notfound: () => ({\n        view: `<div>404 Not Found!</div>`,\n      }),\n      error: () => ({\n        view: \"<div>An error has occurred!</div>\",\n      }),\n    },\n  };\n\n  // routes\n  if (!rules.isEmptyObject(opts.routes)) {\n    // prevalidate routes\n    let routeErrors = {};\n    for (var x in opts.routes) {\n      if (opts.routes.hasOwnProperty(x)) {\n        if (!opts.routes[x].view) {\n          routeErrors[x] = [`A view property is required for route \"${x}\"`];\n        }\n      }\n    }\n    if (Object.keys(routeErrors).length) {\n      throw new Error(\"Invalid route configuration\", routeErrors);\n    }\n    cache.routes = opts.routes;\n  }\n\n  const getProxy = (app) => {\n\n    let builtins = {\n      setState: app.setState,\n      getState: app.getState,\n      dispatch: app.dispatch,\n      listen: app.listen,\n      refresh: app.refresh,\n    };\n\n    // Add plugin api's to proxy\n    return Object.keys(app._plugins).reduce((prev, next) => {\n      let plugin = app._plugins[next];\n      if (plugin.api) {\n        let ref = plugin.global ? plugin.global : plugin.name;\n        if (!prev[ref]) {\n          prev[ref] = plugin.api;\n        } else {\n          prev[ref] = Object.assign(prev[ref], plugin.api);\n        }\n      }\n      return prev;\n    }, builtins);\n  };\n\n  const app = {\n    el: document.body,\n    _currentPath: null,\n    _currentRoute: null,\n    _state: {},\n    _listeners: [],\n    _plugins: {},\n    routes: { ...cache.routes },\n    ok: true,\n    getState: (...args) => {\n      if (args.length) {\n        return app._state[args[0]];\n      }\n      return { ...app._state };\n    },\n    setState: (key, value) => {\n      let oldState = Object.freeze(JSON.parse(JSON.stringify(app._state)));\n      app._state[key] = value;\n      let newState = Object.freeze(JSON.parse(JSON.stringify(app._state)));\n      // change listeners\n      app._listeners.forEach((listener) => {\n        listener(\"stateChange\", newState, oldState, key, value);\n      });\n    },\n    replaceState: (newState) => {\n      let oldState = Object.freeze(JSON.parse(JSON.stringify(app._state)));\n      app._state = newState;\n      app._listeners.forEach((listener) => {\n        listener(\"stateChange\", newState, oldState, \"*\", newState);\n      });\n    },\n    dispatch: (type, ...args) => {\n      app._listeners.forEach((listener) => {\n        listener.apply(null, [type, ...args]);\n      });\n    },\n    listen: (handler) => {\n      if (rules.isFunc(handler)) {\n        app._listeners.push(handler);\n        return () => {\n          let idx = app._listeners.indexOf(handler);\n          if (idx !== -1) {\n            app._listeners.splice(idx, 1);\n          }\n        }\n      } else {\n        console.error(\"Listen handler must be a function\", handler);\n      }\n    },\n    refresh: () => {\n      app.navigate(app._currentPath, true, true);\n    },\n    renderView: async (view, state, meta) => {\n      if (!rules.isFunc(view)) {\n        throw new Error(\"renderView requires a function.\");\n      }\n\n      if (app.el.renderView && rules.isFunc(app.el.renderView)) {\n        if (rules.isAsyncFunc(app.el.renderView)) {\n          try {\n            await app.el.renderView(view, state, meta);\n          } catch (err) {\n            console.error(\"render async view error\", err);\n          }\n        } else {\n          app.el.renderView(view, state, meta);\n        }\n\n        return;\n      }\n\n      if (rules.isAsyncFunc(view)) {\n        try {\n          app.el.innerHTML = await view(state);\n        } catch (err) {\n          console.error(\"Render view errror\", err);\n        }\n      } else {\n        app.el.innerHTML = view(state);\n      }\n\n      if (meta) {\n        document.title = `${opts.metaTitlePrepend}${meta.title}`;\n      }\n    },\n    initRoute: async (route, state) => {\n      const proxy = getProxy(app);\n\n      if (rules.isFunc(route.init)) {\n        if (rules.isAsyncFunc(route.init)) {\n          await route.init(state, proxy, app.el);\n        } else {\n          route.init(state, proxy, app.el);\n        }\n      }\n    },\n    unmountRoute: (route) => {\n      if (route && rules.isFunc(route.unmount)) {\n        route.unmount(getProxy(app));\n      }\n    },\n    routeInit: async (route, state) => {\n      if (opts.routeInit && rules.isFunc(opts.routeInit)) {\n        if (rules.isAsyncFunc(opts.routeInit)) {\n          await opts.routeInit(route, state);\n        } else {\n          opts.routeInit(route, state);\n        }\n      }\n    },\n    navigate: async (pathName, force, refreshOnly) => {\n      // don't fire same route unless forced\n      if (!force && app._currentPath && app._currentPath === pathName) {\n        return false;\n      }\n      const prevPath = app._currentPath;\n      app._currentPath = pathName;\n      let query = {};\n      let params = {};\n\n      const setRoute = async (path, xtra = {}) => {\n        let route = routes[path];\n\n        if (!route) {\n          route = routes[\"/notfound\"] || {\n            view: () => `<div class=\"page\">404 Not Found</div>`,\n          };\n        }\n\n        app._currentRoute = path;\n\n        query = location.search\n          .slice(1)\n          .split(\"&\")\n          .reduce((prev, curr) => {\n            let t = curr.split(\"=\");\n            prev[t[0]] = decodeURIComponent(t[1] || \"\");\n            return prev;\n          }, {});\n        let state = { ...app.getState(), ...xtra, query, path };\n\n        // Pre-render hook\n        if (!refreshOnly) {\n          try {\n            await app.routeInit(route, state);\n          } catch (err) {\n            console.error(\"Pre-render failed:\", err);\n          }\n        }\n\n        // Render view\n        try {\n          await app.renderView(route.view, state, route.meta);\n        } catch (err) {\n          console.error(\"Render view failed\", err);\n        }\n\n        // Initialize route\n        try {\n          await app.initRoute(route, state);\n        } catch (err) {\n          console.error(\n            `Init route for \"${route.name ? route.name : path}\" failed`,\n            err\n          );\n        }\n\n        const { params = {} } = xtra;\n\n        if (!refreshOnly) {\n          app._listeners.forEach((listener) => {\n            listener(\"pageChange\", {\n              from: prevPath,\n              to: app._currentRoute,\n              params,\n              query,\n            });\n          });\n        }\n      };\n\n      const { routes } = app;\n\n      // Unmount current route, if any\n      if (!refreshOnly) {\n        if (app._currentRoute) {\n          app.unmountRoute(app.routes[app._currentRoute]);\n        }\n      }\n\n      // exact match\n      if (routes[pathName]) {\n        app._currentRoute = pathName;\n        setRoute(pathName);\n        return { path: pathName, route: pathName, query, params };\n      }\n\n      // param route w/fuzzy match logic\n      let tokens = pathName.split(\"/\").slice(1);\n      let found = Object.keys(routes).filter((x) => {\n        return (\n          x.indexOf(`/${tokens[0]}`) !== -1 &&\n          x.split(\"/\").slice(1).length === tokens.length\n        );\n      })[0];\n\n      if (found) {\n        found\n          .split(\"/\")\n          .slice(2)\n          .forEach((n, x) => {\n            params[n.slice(1)] = tokens[x + 1];\n          });\n        setRoute(found, { params });\n        return { path: pathName, route: found, query, params };\n      }\n      // Not found\n      app._currentRoute = opts.notFoundRouteName;\n      setRoute(opts.notFoundUrl);\n      return { path: pathName, route: undefined, query, params };\n    },\n    boot: async () => {\n      // Runs on startup. Intended to be monkey patched in plugins.\n    },\n  };\n\n  const proxy = {\n    use: (plugin, options = {}) => {\n      if (!plugin.name) {\n        throw new Error(\"A plugin must have a name property.\");\n      }\n      if (!plugin.install || !rules.isFunc(plugin.install)) {\n        throw new Error(\"A plugin must define an install method.\");\n      }\n      if (app._plugins[plugin.name]) {\n        throw new Error(\n          `A plugin with the name: \"${plugin.name} is already registered.\"`\n        );\n      }\n      app._plugins[plugin.name] = plugin;\n      try {\n        let api = plugin.install(app, options);\n        if (api) {\n          app._plugins[plugin.name].api = api;\n          // Add to window global\n          if(plugin.global) {\n            if (!window[plugin.global]) {\n              window[plugin.global] = api;\n            } else {\n              window[plugin.global] = Object.assign(window[plugin.global], api);\n            }\n          }\n        }\n      } catch (err) {\n        console.error(`Plugin \"${plugin.name}\" failed to install.`, err);\n        delete app._plugins[plugin.name];\n      }\n\n      return proxy;\n    },\n    mount: async (el) => {\n      try {\n        if (rules.isString(el)) {\n          app.el = document.querySelector(el);\n          if (!app.el) {\n            throw new Error(\n              `Invalid mount target: ${el}. Missing from the DOM.`\n            );\n          }\n        } else {\n          if (!rules.isNode(el) || !rules.isElement(el)) {\n            throw new Error(\"Invalid DOM object for mount.\");\n          }\n          app.el = el;\n        }\n\n        if (rules.isFunc(opts.init)) {\n          // try to just invoke function;\n          app._state = rules.isAsyncFunc(opts.init)\n            ? await opts.init()\n            : opts.init();\n        } else {\n          app._state = opts.init || {};\n        }\n\n        if (opts.debug) {\n          console.log(\"Initial app state\", app._state);\n        }\n\n        window.onpopstate = async () => {\n          await app.navigate(window.location.pathname);\n        };\n\n        app.global = opts.global;\n        window[opts.global] = window[opts.global] || {};\n\n        window[opts.global].navigate = async (pathName) => {\n          window.history.pushState(\n            {},\n            pathName,\n            window.location.origin + pathName\n          );\n          await app.navigate(pathName);\n        };\n\n        window[opts.global].dispatch = app.dispatch.bind(app);\n\n        await app.boot();\n\n        await app.navigate(window.location.pathname);\n\n        return app;\n      } catch (e) {\n        return { ok: false, error: e };\n      }\n    },\n  };\n\n  return proxy;\n};\n"],"names":["rules","isString","o","isEmptyObject","name","hasOwnProperty","isFunc","isAsyncFunc","fn","constructor","isNode","Node","nodeType","nodeName","isElement","HTMLElement","_catch","body","recover","result","e","then","defaultOptions","global","appName","metaTitlePrepend","routes","notFoundRouteName","notFoundUrl","options","opts","Object","assign","cache","/","view","notfound","error","routeErrors","x","keys","length","Error","getProxy","app","builtins","setState","getState","dispatch","listen","refresh","_plugins","reduce","prev","next","plugin","api","ref","el","document","_currentPath","_currentRoute","_state","_listeners","ok","args","key","value","oldState","freeze","JSON","parse","stringify","newState","forEach","listener","replaceState","type","apply","handler","push","idx","indexOf","splice","console","navigate","renderView","state","meta","title","innerHTML","err","initRoute","route","proxy","init","unmountRoute","unmount","routeInit","pathName","force","refreshOnly","prevPath","query","params","setRoute","path","xtra","from","to","location","search","slice","split","curr","t","decodeURIComponent","tokens","found","filter","n","undefined","boot","use","install","window","mount","debug","log","onpopstate","pathname","history","pushState","origin","bind","querySelector"],"mappings":"6XAAA,IAAMA,EAAQ,CACVC,SAAU,SAACC,GACT,OAAa,OAANA,GAA2B,iBAANA,GAE9BC,cAAe,SAACD,GACd,IAAIE,EACJ,IAAKA,KAAQF,EACX,GAAIA,EAAEG,eAAeD,GAAO,SAE9B,UAEFE,OAAQ,SAACJ,GACP,MAAoB,mBAANA,GAEhBK,YAAa,SAACC,GACZ,OAAOR,EAAMM,OAAOE,IAA+B,kBAAxBA,EAAGC,YAAYL,MAE5CM,OAAQ,SAACR,GACP,MAAuB,iBAATS,KACVT,aAAaS,KACbT,GACe,iBAANA,GACe,iBAAfA,EAAEU,UACa,iBAAfV,EAAEW,UAEjBC,UAAW,SAACZ,GACV,MAA8B,iBAAhBa,YACVb,aAAaa,YACbb,GACe,iBAANA,GACD,OAANA,GACe,IAAfA,EAAEU,UACoB,iBAAfV,EAAEW,WCkhBd,SAASG,EAAOC,EAAMC,GAC5B,IACC,IAAIC,EAASF,IACZ,MAAMG,GACP,OAAOF,EAAQE,GAEhB,OAAID,GAAUA,EAAOE,KACbF,EAAOE,UAAK,EAAQH,GAErBC,EAzjBR,IAAMG,EAAiB,CACrBC,OAAQ,IACRC,QAAS,MACTC,iBAAkB,GAClBC,OAAQ,GACRC,kBAAmB,WACnBC,YAAa,6BAGOC,OACpB,IAAIC,EAAOC,OAAOC,OAAO,GAAIV,EAAgBO,GAEzCI,EAAQ,CACVP,OAAQ,CACNQ,IAAK,iBAAO,CACVC,gCAEFC,SAAU,iBAAO,CACfD,mCAEFE,MAAO,iBAAO,CACZF,KAAM,wCAMZ,IAAKnC,EAAMG,cAAc2B,EAAKJ,QAAS,CAErC,IAAIY,EAAc,GAClB,IAAK,IAAIC,KAAKT,EAAKJ,OACbI,EAAKJ,OAAOrB,eAAekC,KACxBT,EAAKJ,OAAOa,GAAGJ,OAClBG,EAAYC,GAAK,2CAA2CA,SAIlE,GAAIR,OAAOS,KAAKF,GAAaG,OAC3B,UAAUC,MAAM,8BAA+BJ,GAEjDL,EAAMP,OAASI,EAAKJ,OAGtB,IAAMiB,EAAW,SAACC,GAEhB,IAAIC,EAAW,CACbC,SAAUF,EAAIE,SACdC,SAAUH,EAAIG,SACdC,SAAUJ,EAAII,SACdC,OAAQL,EAAIK,OACZC,QAASN,EAAIM,SAIf,OAAOnB,OAAOS,KAAKI,EAAIO,UAAUC,OAAO,SAACC,EAAMC,GAC7C,IAAIC,EAASX,EAAIO,SAASG,GAC1B,GAAIC,EAAOC,IAAK,CACd,IAAIC,EAAMF,EAAOhC,OAASgC,EAAOhC,OAASgC,EAAOnD,KAI/CiD,EAAKI,GAHFJ,EAAKI,GAGI1B,OAAOC,OAAOqB,EAAKI,GAAMF,EAAOC,KAFhCD,EAAOC,IAKvB,OAAOH,GACNR,IAGCD,EAAM,CACVc,GAAIC,SAAS1C,KACb2C,aAAc,KACdC,cAAe,KACfC,OAAQ,GACRC,WAAY,GACZZ,SAAU,GACVzB,YAAaO,EAAMP,QACnBsC,IAAI,EACJjB,SAAU,eAAIkB,2BACZ,OAAIA,EAAKxB,OACAG,EAAIkB,OAAOG,EAAK,SAEbrB,EAAIkB,SAElBhB,SAAU,SAACoB,EAAKC,GACd,IAAIC,EAAWrC,OAAOsC,OAAOC,KAAKC,MAAMD,KAAKE,UAAU5B,EAAIkB,UAC3DlB,EAAIkB,OAAOI,GAAOC,EAClB,IAAIM,EAAW1C,OAAOsC,OAAOC,KAAKC,MAAMD,KAAKE,UAAU5B,EAAIkB,UAE3DlB,EAAImB,WAAWW,QAAQ,SAACC,GACtBA,EAAS,cAAeF,EAAUL,EAAUF,EAAKC,MAGrDS,aAAc,SAACH,GACb,IAAIL,EAAWrC,OAAOsC,OAAOC,KAAKC,MAAMD,KAAKE,UAAU5B,EAAIkB,UAC3DlB,EAAIkB,OAASW,EACb7B,EAAImB,WAAWW,QAAQ,SAACC,GACtBA,EAAS,cAAeF,EAAUL,EAAU,IAAKK,MAGrDzB,SAAU,SAAC6B,mBACTjC,EAAImB,WAAWW,QAAQ,SAACC,GACtBA,EAASG,MAAM,MAAOD,kCAG1B5B,OAAQ,SAAC8B,GACP,GAAI/E,EAAMM,OAAOyE,GAEf,OADAnC,EAAImB,WAAWiB,KAAKD,cAElB,IAAIE,EAAMrC,EAAImB,WAAWmB,QAAQH,IACpB,IAATE,GACFrC,EAAImB,WAAWoB,OAAOF,EAAK,IAI/BG,QAAQ/C,MAAM,oCAAqC0C,IAGvD7B,QAAS,WACPN,EAAIyC,SAASzC,EAAIgB,cAAc,GAAM,IAEvC0B,oBAAmBnD,EAAMoD,EAAOC,sDA6B1BA,IACF7B,SAAS8B,SAAW3D,EAAKL,iBAAmB+D,EAAKC,2BAX/CzF,EAAMO,YAAY4B,8CAEOA,EAAKoD,qBAA9B3C,EAAIc,GAAGgC,wBACAC,GACPP,QAAQ/C,MAAM,qBAAsBsD,mDAGtC/C,EAAIc,GAAGgC,UAAYvD,EAAKoD,sCAzB1B,IAAKvF,EAAMM,OAAO6B,GAChB,UAAUO,MAAM,mCAFqB,oBAKnCE,EAAIc,GAAG4B,YAActF,EAAMM,OAAOsC,EAAIc,GAAG4B,mDACvCtF,EAAMO,YAAYqC,EAAIc,GAAG4B,uDAEnB1C,EAAIc,GAAG4B,WAAWnD,EAAMoD,EAAOC,iCAC9BG,GACPP,QAAQ/C,MAAM,0BAA2BsD,mDAG3C/C,EAAIc,GAAG4B,WAAWnD,EAAMoD,EAAOC,0FAb3B,oCAiCVI,mBAAkBC,EAAON,OACvB,IAAMO,EAAQnD,EAASC,mBAEnB5C,EAAMM,OAAOuF,EAAME,2BACjB/F,EAAMO,YAAYsF,EAAME,6BACpBF,EAAME,KAAKR,EAAOO,EAAOlD,EAAIc,wBAEnCmC,EAAME,KAAKR,EAAOO,EAAOlD,EAAIc,kHAP1B,oCAWTsC,aAAc,SAACH,GACTA,GAAS7F,EAAMM,OAAOuF,EAAMI,UAC9BJ,EAAMI,QAAQtD,EAASC,KAG3BsD,mBAAkBL,EAAON,2BACnBzD,EAAKoE,WAAalG,EAAMM,OAAOwB,EAAKoE,gCAClClG,EAAMO,YAAYuB,EAAKoE,kCACnBpE,EAAKoE,UAAUL,EAAON,uBAE5BzD,EAAKoE,UAAUL,EAAON,iHALnB,oCASTF,kBAAiBc,EAAUC,EAAOC,OAEhC,IAAKD,GAASxD,EAAIgB,cAAgBhB,EAAIgB,eAAiBuC,EACrD,wBAAO,GAET,IAAMG,EAAW1D,EAAIgB,aACrBhB,EAAIgB,aAAeuC,EACnB,IAAII,EAAQ,GACRC,EAAS,GAEPC,WAAkBC,EAAMC,YAAAA,IAAAA,EAAO,yDA+CXA,EAAhBH,OAAAA,aAAS,KAEZH,GACHzD,EAAImB,WAAWW,QAAQ,SAACC,GACtBA,EAAS,aAAc,CACrBiC,KAAMN,EACNO,GAAIjE,EAAIiB,cACR2C,OAAAA,EACAD,MAAAA,gDAhBE3D,EAAIgD,UAAUC,EAAON,iCACpBI,GACPP,QAAQ/C,0BACawD,EAAMzF,KAAOyF,EAAMzF,KAAOsG,cAC7Cf,8EAXI/C,EAAI0C,WAAWO,EAAM1D,KAAMoD,EAAOM,EAAML,oCACvCG,GACPP,QAAQ/C,MAAM,qBAAsBsD,qCAjClCE,EAAQnE,EAAOgF,GAEdb,IACHA,EAAQnE,EAAO,cAAgB,CAC7BS,KAAM,4DAIVS,EAAIiB,cAAgB6C,EAEpBH,EAAQO,SAASC,OACdC,MAAM,GACNC,MAAM,KACN7D,OAAO,SAACC,EAAM6D,GACb,IAAIC,EAAID,EAAKD,MAAM,KAEnB,OADA5D,EAAK8D,EAAE,IAAMC,mBAAmBD,EAAE,IAAM,IACjC9D,GACN,IACL,IAAIkC,OAAa3C,EAAIG,WAAe4D,GAAMJ,MAAAA,EAAOG,KAAAA,qBAG5CL,6CAEKzD,EAAIsD,UAAUL,EAAON,iCACpBI,GACPP,QAAQ/C,MAAM,qBAAsBsD,kGA1B5B,oCA6DNjE,EAAWkB,EAAXlB,OAUR,GAPK2E,GACCzD,EAAIiB,eACNjB,EAAIoD,aAAapD,EAAIlB,OAAOkB,EAAIiB,gBAKhCnC,EAAOyE,GAGT,OAFAvD,EAAIiB,cAAgBsC,EACpBM,EAASN,mBACF,CAAEO,KAAMP,EAAUN,MAAOM,EAAUI,MAAAA,EAAOC,OAAAA,IAInD,IAAIa,EAASlB,EAASc,MAAM,KAAKD,MAAM,GACnCM,EAAQvF,OAAOS,KAAKd,GAAQ6F,OAAO,SAAChF,GACtC,OACkC,IAAhCA,EAAE2C,YAAYmC,EAAO,KACrB9E,EAAE0E,MAAM,KAAKD,MAAM,GAAGvE,SAAW4E,EAAO5E,SAEzC,GAEH,OAAI6E,GACFA,EACGL,MAAM,KACND,MAAM,GACNtC,QAAQ,SAAC8C,EAAGjF,GACXiE,EAAOgB,EAAER,MAAM,IAAMK,EAAO9E,EAAI,KAEpCkE,EAASa,EAAO,CAAEd,OAAAA,oBACX,CAAEE,KAAMP,EAAUN,MAAOyB,EAAOf,MAAAA,EAAOC,OAAAA,MAGhD5D,EAAIiB,cAAgB/B,EAAKH,kBACzB8E,EAAS3E,EAAKF,6BACP,CAAE8E,KAAMP,EAAUN,WAAO4B,EAAWlB,MAAAA,EAAOC,OAAAA,KA7G5C,oCA+GRkB,2CAKI5B,EAAQ,CACZ6B,IAAK,SAACpE,EAAQ1B,GACZ,YADYA,IAAAA,EAAU,KACjB0B,EAAOnD,KACV,UAAUsC,MAAM,uCAElB,IAAKa,EAAOqE,UAAY5H,EAAMM,OAAOiD,EAAOqE,SAC1C,UAAUlF,MAAM,2CAElB,GAAIE,EAAIO,SAASI,EAAOnD,MACtB,UAAUsC,kCACoBa,EAAOnD,iCAGvCwC,EAAIO,SAASI,EAAOnD,MAAQmD,EAC5B,IACE,IAAIC,EAAMD,EAAOqE,QAAQhF,EAAKf,GAC1B2B,IACFZ,EAAIO,SAASI,EAAOnD,MAAMoD,IAAMA,EAE7BD,EAAOhC,SACHsG,OAAOtE,EAAOhC,QAGjBsG,OAAOtE,EAAOhC,QAAUQ,OAAOC,OAAO6F,OAAOtE,EAAOhC,QAASiC,GAF7DqE,OAAOtE,EAAOhC,QAAUiC,IAM9B,MAAOmC,GACPP,QAAQ/C,iBAAiBkB,EAAOnD,4BAA4BuF,UACrD/C,EAAIO,SAASI,EAAOnD,MAG7B,OAAO0F,GAETgC,eAAcpE,wDACR,OAwBE5B,EAAKiG,OACP3C,QAAQ4C,IAAI,oBAAqBpF,EAAIkB,QAGvC+D,OAAOI,iDACCrF,EAAIyC,SAASwC,OAAOf,SAASoB,8BADrC,oCAIAtF,EAAIrB,OAASO,EAAKP,OAClBsG,OAAO/F,EAAKP,QAAUsG,OAAO/F,EAAKP,SAAW,GAE7CsG,OAAO/F,EAAKP,QAAQ8D,kBAAkBc,OAAa,OACjD0B,OAAOM,QAAQC,UACb,GACAjC,EACA0B,OAAOf,SAASuB,OAASlC,mBAErBvD,EAAIyC,SAASc,uBANrB,oCASA0B,OAAO/F,EAAKP,QAAQyB,SAAWJ,EAAII,SAASsF,KAAK1F,mBAE3CA,EAAI8E,+CAEJ9E,EAAIyC,SAASwC,OAAOf,SAASoB,2BAEnC,OAAOtF,MAjDP,GAAI5C,EAAMC,SAASyD,IAEjB,GADAd,EAAIc,GAAKC,SAAS4E,cAAc7E,IAC3Bd,EAAIc,GACP,UAAUhB,+BACiBgB,iCAGxB,CACL,IAAK1D,EAAMU,OAAOgD,KAAQ1D,EAAMc,UAAU4C,GACxC,UAAUhB,MAAM,iCAElBE,EAAIc,GAAKA,EAZT,oBAeE1D,EAAMM,OAAOwB,EAAKiE,yBAEpBnD,EAAIkB,iBAAS9D,EAAMO,YAAYuB,EAAKiE,sBAC1BjE,EAAKiE,kBACXjE,EAAKiE,QAETnD,EAAIkB,OAAShC,EAAKiE,MAAQ,+CA8BrB3E,GACP,MAAO,CAAE4C,IAAI,EAAO3B,MAAOjB,MArD1B,qCA0DP,uBAAO0E,GAzXT"}