{"version":3,"file":"webx1.umd.js","sources":["../src/utils/rules.js","../src/index.js"],"sourcesContent":["const rules = {\n    isArray: (o) => {\n        return Array.isArray(o);\n    },\n    isString: (o) => {\n      return o !== null && typeof o === \"string\";\n    },\n    isEmptyObject: (o) => {\n      var name;\n      for (name in o) {\n        if (o.hasOwnProperty(name)) return false;\n      }\n      return true;\n    },\n    isFunc: (o) => {\n      return typeof o === \"function\";\n    },\n    isAsyncFunc: (fn) => {\n      return rules.isFunc(fn) && fn.constructor.name === \"AsyncFunction\";\n    },\n    isNode: (o) => {\n      return typeof Node === \"object\"\n        ? o instanceof Node\n        : o &&\n            typeof o === \"object\" &&\n            typeof o.nodeType === \"number\" &&\n            typeof o.nodeName === \"string\";\n    },\n    isElement: (o) => {\n      return typeof HTMLElement === \"object\"\n        ? o instanceof HTMLElement //DOM2\n        : o &&\n            typeof o === \"object\" &&\n            o !== null &&\n            o.nodeType === 1 &&\n            typeof o.nodeName === \"string\";\n    },\n  };\n\n  export default rules;","import rules from \"./utils/rules\";\n\nconst defaultOptions = {\n  global: \"$\",\n  appName: \"App\",\n  metaTitlePrepend: \"\",\n  routes: {},\n  notFoundRouteName: \"notfound\",\n  notFoundUrl: \"/notfound\",\n};\n\nexport default async (options) => {\n  let opts = Object.assign({}, defaultOptions, options);\n\n  let cache = {\n    routes: {\n      \"/\": () => ({\n        view: `<div>Webx Rocks!</div>`,\n      }),\n      notfound: () => ({\n        view: `<div>404 Not Found!</div>`,\n      }),\n      error: () => ({\n        view: \"<div>An error has occurred!</div>\",\n      }),\n    },\n  };\n\n  // routes  \n  if (!rules.isEmptyObject(opts.routes)) {\n    // prevalidate routes\n    let routeErrors = {};\n    for (var x in opts.routes) {\n      if (opts.routes.hasOwnProperty(x)) {\n        let route = opts.routes[x];        \n        if (rules.isFunc(route)) {\n          route = await route();\n        }\n        if (!route.view) {\n          routeErrors[x] = [`A view property is required for route \"${x}\"`];\n        }\n      }\n    }\n    if (Object.keys(routeErrors).length) {\n      throw new Error(\"Invalid route configuration\", routeErrors);\n    }\n    cache.routes = opts.routes;\n  }\n\n  const getProxy = (app) => {\n    let builtins = {\n      setState: app.setState,\n      getState: app.getState,\n      dispatch: app.dispatch,\n      listen: app.listen,\n      refresh: app.refresh,\n    };\n\n    // Add plugin api's to proxy\n    return Object.keys(app._plugins).reduce((prev, next) => {\n      let plugin = app._plugins[next];\n      if (plugin.api) {\n        let ref = plugin.namespace ? plugin.namespace : plugin.name;\n        if (!prev[ref]) {\n          prev[ref] = plugin.api;\n        } else {\n          prev[ref] = Object.assign(prev[ref], plugin.api);\n        }\n      }\n      return prev;\n    }, builtins);\n  };\n\n  const app = {\n    el: document.body,\n    _currentPath: null,\n    _currentRoute: null,\n    _state: {},\n    _listeners: [],\n    _plugins: {},\n    routes: { ...cache.routes },\n    ok: true,\n    plugin: (plugin, options = {}) => {\n      if (!plugin.name) {\n        throw new Error(\"A plugin must have a name property.\");\n      }\n      if (!plugin.install || !rules.isFunc(plugin.install)) {\n        throw new Error(\"A plugin must define an install method.\");\n      }\n      if (app._plugins[plugin.name]) {\n        throw new Error(\n          `A plugin with the name: \"${plugin.name} is already registered.\"`\n        );\n      }\n      app._plugins[plugin.name] = plugin;\n      try {\n        let api = plugin.install(app, options);\n        if (api) {\n          app._plugins[plugin.name].api = api;\n          // Add to window global\n          if (plugin.global) {\n            if (!window[plugin.global]) {\n              window[plugin.global] = api;\n            } else {\n              window[plugin.global] = Object.assign(window[plugin.global], api);\n            }\n          }\n          // Update app context\n          app.ctx = getProxy(app);\n        }\n        if (options.installed && rules.isFunc(options.installed)) {\n          options.installed();\n        }\n      } catch (err) {\n        console.error(`Plugin \"${plugin.name}\" failed to install.`, err);\n        if (options.onError && rules.isFunc(options.onError)) {\n          options.onError(err);\n        }\n        delete app._plugins[plugin.name];\n      }\n    },\n    getState: (...args) => {\n      if (args.length) {\n        return app._state[args[0]];\n      }\n      return { ...app._state };\n    },\n    setState: (key, value) => {\n      let oldState = Object.freeze(JSON.parse(JSON.stringify(app._state)));\n      app._state[key] = value;\n      let newState = Object.freeze(JSON.parse(JSON.stringify(app._state)));\n      // change listeners\n      app._listeners.forEach((listener) => {\n        listener(\"stateChange\", newState, oldState, key, value);\n      });\n    },\n    replaceState: (newState) => {\n      let oldState = Object.freeze(JSON.parse(JSON.stringify(app._state)));\n      app._state = newState;\n      app._listeners.forEach((listener) => {\n        listener(\"stateChange\", newState, oldState, \"*\", newState);\n      });\n    },\n    dispatch: (type, ...args) => {\n      app._listeners.forEach((listener) => {\n        listener.apply(null, [type, ...args]);\n      });\n    },\n    listen: (handler) => {\n      if (rules.isFunc(handler)) {\n        app._listeners.push(handler);\n        return () => {\n          let idx = app._listeners.indexOf(handler);\n          if (idx !== -1) {\n            app._listeners.splice(idx, 1);\n          }\n        };\n      } else {\n        console.error(\"Listen handler must be a function\", handler);\n      }\n    },\n    refresh: () => {\n      app.navigate(app._currentPath, true, true)\n        .then(() => app.dispatch('refreshed', app._currentPath))      \n    },\n    renderView: async (view, state, meta) => {\n      if (!rules.isFunc(view)) {\n        throw new Error(\"renderView requires a function.\");\n      }\n\n      if (app.el.renderView && rules.isFunc(app.el.renderView)) {\n        try {\n          await app.el.renderView(view, state, meta);\n        } catch (err) {\n          console.error(\"render async view error\", err);\n        }\n\n        return;\n      }\n\n      try {\n        app.el.innerHTML = await view(state);\n      } catch (err) {\n        console.error(\"Render view errror\", err);\n      }\n\n      if (meta) {\n        document.title = `${opts.metaTitlePrepend}${meta.title}`;\n      }\n\n      app.dispatch('view-rendered', { detail: view });\n    },\n    initRoute: async (route, state) => {\n      const proxy = getProxy(app);\n\n      if (rules.isFunc(route.init)) {\n        await route.init(state, proxy, app.el);\n      }\n    },\n    unmountRoute: (route) => {\n      if (route && rules.isFunc(route.unmount)) {\n        route.unmount(getProxy(app));\n      }\n    },\n    routeInit: async (route, state) => {\n      if (opts.routeInit && rules.isFunc(opts.routeInit)) {\n        await opts.routeInit(route, state);\n      }\n    },\n    navigate: async (pathName, force, refreshOnly) => {\n      // don't fire same route unless forced\n      if (!force && app._currentPath && app._currentPath === pathName) {\n        return false;\n      }\n      const prevPath = app._currentPath;\n      app._currentPath = pathName;\n      let query = {};\n      let params = {};\n\n      const setRoute = async (path, xtra = {}) => {\n        let route = routes[path];\n\n        if (!route) {\n          route = routes[\"/notfound\"] || {\n            view: () => `<div class=\"page\">404 Not Found</div>`,\n          };\n        }\n\n        app._currentRoute = path;\n\n        query = location.search\n          .slice(1)\n          .split(\"&\")\n          .reduce((prev, curr) => {\n            let t = curr.split(\"=\");\n            prev[t[0]] = decodeURIComponent(t[1] || \"\");\n            return prev;\n          }, {});\n        let state = { ...app.getState(), ...xtra, query, path };\n\n        // Pre-render hook\n        if (!refreshOnly) {\n          try {\n            let routeState = await app.routeInit(route, state);\n            if (routeState && !rules.isEmptyObject(routeState)) {\n              state = {...state, routeState};\n            }\n          } catch (err) {\n            console.error(\"Pre-render failed:\", err);\n          }\n        }\n\n        // Render view\n        try {\n          await app.renderView(route.view, state, route.meta);\n        } catch (err) {\n          console.error(\"Render view failed\", err);\n        }\n\n        // Initialize route\n        try {\n          await app.initRoute(route, state);\n        } catch (err) {\n          console.error(\n            `Init route for \"${route.name ? route.name : path}\" failed`,\n            err\n          );\n        }\n\n        const { params = {} } = xtra;\n\n        if (!refreshOnly) {\n          app._listeners.forEach((listener) => {\n            listener(\"pageChange\", {\n              from: prevPath,\n              to: app._currentRoute,\n              params,\n              query,\n            });\n          });\n        }\n      };\n\n      const { routes } = app;\n\n      // Unmount current route, if any\n      if (!refreshOnly) {\n        if (app._currentRoute) {\n          app.unmountRoute(app.routes[app._currentRoute]);\n        }\n      }\n\n      // exact match\n      if (routes[pathName]) {\n        app._currentRoute = pathName;\n        setRoute(pathName);\n        return { path: pathName, route: pathName, query, params };\n      }\n\n      // param route w/fuzzy match logic\n      let tokens = pathName.split(\"/\").slice(1);\n      let found = Object.keys(routes).filter((x) => {\n        return (\n          x.indexOf(`/${tokens[0]}`) !== -1 &&\n          x.split(\"/\").slice(1).length === tokens.length\n        );\n      })[0];\n\n      if (found) {\n        found\n          .split(\"/\")\n          .slice(2)\n          .forEach((n, x) => {\n            params[n.slice(1)] = tokens[x + 1];\n          });\n        setRoute(found, { params });\n        return { path: pathName, route: found, query, params };\n      }\n      // Not found\n      app._currentRoute = opts.notFoundRouteName;\n      setRoute(opts.notFoundUrl);\n      return { path: pathName, route: undefined, query, params };\n    },\n    boot: async () => {\n      // Runs on startup. Intended to be monkey patched in plugins.\n    },\n  };\n\n  const mount = async (el) => {\n    try {\n      if (rules.isString(el)) {\n        app.el = document.querySelector(el);\n        if (!app.el) {\n          throw new Error(`Invalid mount target: ${el}. Missing from the DOM.`);\n        }\n      } else {\n        if (!rules.isNode(el) || !rules.isElement(el)) {\n          throw new Error(\"Invalid DOM object for mount.\");\n        }\n        app.el = el;\n      }\n\n      if (rules.isFunc(opts.init)) {\n        // try to just invoke function;\n        app._state = await opts.init();\n      } else {\n        app._state = opts.init || {};\n      }\n\n      if (opts.debug) {\n        console.log(\"Initial app state\", app._state);\n      }\n\n      window.onpopstate = async () => {\n        await app.navigate(window.location.pathname);\n      };\n\n      app.global = opts.global;\n      window[opts.global] = window[opts.global] || {};\n\n      window[opts.global].navigate = async (pathName) => {\n        window.history.pushState(\n          {},\n          pathName,\n          window.location.origin + pathName\n        );\n        await app.navigate(pathName);\n      };\n\n      window[opts.global].dispatch = app.dispatch.bind(app);\n\n      await app.boot();\n\n      await app.navigate(window.location.pathname);\n\n      return app;\n    } catch (e) {\n      return { ok: false, error: e };\n    }\n  };\n\n  app.el = opts.node || document.body;\n\n  // Expects plugins in array format plugins: [[plugin1, options1], [plugin2, options2]]\n  if (opts.plugins && rules.isArray(opts.plugins)) {\n    opts.plugins.forEach((plugin) => {\n      app.plugin(plugin[0], plugin.length > 1 ? plugin[1] : {});\n    });\n  }\n\n  // set the app context\n  app.ctx = getProxy(app);\n\n  if (opts.node && (rules.isElement(opts.node) || rules.isNode(opts.node))) {\n    return mount(opts.node);\n  }\n\n  return mount(document.body);\n};\n"],"names":["rules","isArray","o","Array","isString","isEmptyObject","name","hasOwnProperty","isFunc","isAsyncFunc","fn","constructor","isNode","Node","nodeType","nodeName","isElement","HTMLElement","_settle","pact","state","value","s","_Pact","bind","v","then","observer","defaultOptions","global","appName","metaTitlePrepend","routes","notFoundRouteName","notFoundUrl","prototype","onFulfilled","onRejected","result","this","callback","e","_this","body","recover","options","getProxy","app","builtins","setState","getState","dispatch","listen","refresh","Object","keys","_plugins","reduce","prev","next","plugin","api","ref","namespace","assign","el","document","_currentPath","_currentRoute","_state","_listeners","cache","ok","Error","install","window","ctx","installed","err","console","error","onError","args","length","key","oldState","freeze","JSON","parse","stringify","newState","forEach","listener","replaceState","type","apply","handler","push","idx","indexOf","splice","navigate","renderView","view","meta","title","opts","detail","innerHTML","initRoute","route","proxy","init","unmountRoute","unmount","routeInit","pathName","force","refreshOnly","prevPath","query","params","setRoute","path","xtra","from","to","location","search","slice","split","curr","t","decodeURIComponent","routeState","tokens","found","filter","x","n","undefined","boot","mount","debug","log","onpopstate","pathname","history","pushState","origin","querySelector","node","plugins","/","notfound","routeErrors","target","check","array","reject","i","_cycle","thenable"],"mappings":"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"}