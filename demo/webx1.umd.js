!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).webx1=n()}(this,function(){function e(){return(e=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var n={isArray:function(e){return Array.isArray(e)},isString:function(e){return null!==e&&"string"==typeof e},isEmptyObject:function(e){var n;for(n in e)if(e.hasOwnProperty(n))return!1;return!0},isFunc:function(e){return"function"==typeof e},isAsyncFunc:function(e){return n.isFunc(e)&&"AsyncFunction"===e.constructor.name},isNode:function(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},isElement:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}};function t(e,n,r){if(!e.s){if(r instanceof o){if(!r.s)return void(r.o=t.bind(null,e,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(t.bind(null,e,n),t.bind(null,e,2));e.s=n,e.v=r;var i=e.o;i&&i(e)}}var r={global:"$",appName:"App",metaTitlePrepend:"",routes:{},notFoundRouteName:"notfound",notFoundUrl:"/notfound"},o=function(){function e(){}return e.prototype.then=function(n,r){var o=new e,i=this.s;if(i){var u=1&i?n:r;if(u){try{t(o,1,u(this.v))}catch(e){t(o,2,e)}return o}return this}return this.o=function(e){try{var i=e.v;1&e.s?t(o,1,n?n(i):i):r?t(o,1,r(i)):t(o,2,i)}catch(e){t(o,2,e)}},o},e}();function i(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}return function(u){try{var c=function(t){var r=function(e){var n={setState:e.setState,getState:e.getState,dispatch:e.dispatch,listen:e.listen,refresh:e.refresh};return Object.keys(e._plugins).reduce(function(n,t){var r=e._plugins[t];if(r.api){var o=r.namespace?r.namespace:r.name;n[o]=n[o]?Object.assign(n[o],r.api):r.api}return n},n)},o={el:document.body,_currentPath:null,_currentRoute:null,_state:{},_listeners:[],_plugins:{},routes:e({},a.routes),ok:!0,plugin:function(e,t){if(void 0===t&&(t={}),!e.name)throw new Error("A plugin must have a name property.");if(!e.install||!n.isFunc(e.install))throw new Error("A plugin must define an install method.");if(o._plugins[e.name])throw new Error('A plugin with the name: "'+e.name+' is already registered."');o._plugins[e.name]=e;try{var i=e.install(o,t);i&&(o._plugins[e.name].api=i,e.global&&(window[e.global]?window[e.global]=Object.assign(window[e.global],i):window[e.global]=i),o.ctx=r(o)),t.installed&&n.isFunc(t.installed)&&t.installed()}catch(r){console.error('Plugin "'+e.name+'" failed to install.',r),t.onError&&n.isFunc(t.onError)&&t.onError(r),delete o._plugins[e.name]}},getState:function(){var n=[].slice.call(arguments);return n.length?o._state[n[0]]:e({},o._state)},setState:function(e,n){var t=Object.freeze(JSON.parse(JSON.stringify(o._state)));o._state[e]=n;var r=Object.freeze(JSON.parse(JSON.stringify(o._state)));o._listeners.forEach(function(o){o("stateChange",r,t,e,n)})},replaceState:function(e){var n=Object.freeze(JSON.parse(JSON.stringify(o._state)));o._state=e,o._listeners.forEach(function(t){t("stateChange",e,n,"*",e)})},dispatch:function(e){var n=arguments;o._listeners.forEach(function(t){t.apply(null,[e].concat([].slice.call(n,1)))})},listen:function(e){if(n.isFunc(e))return o._listeners.push(e),function(){var n=o._listeners.indexOf(e);-1!==n&&o._listeners.splice(n,1)};console.error("Listen handler must be a function",e)},refresh:function(){o.navigate(o._currentPath,!0,!0).then(function(){return o.dispatch("refreshed",o._currentPath)})},renderView:function(e,t,r){try{var u,c=function(n){if(u)return n;function c(){r&&(document.title=""+s.metaTitlePrepend+r.title),o.dispatch("view-rendered",{detail:e})}var a=i(function(){return Promise.resolve(e(t)).then(function(e){o.el.innerHTML=e})},function(e){console.error("Render view errror",e)});return a&&a.then?a.then(c):c()};if(!n.isFunc(e))throw new Error("renderView requires a function.");var a=function(){if(o.el.renderView&&n.isFunc(o.el.renderView)){var c=function(){u=1},s=i(function(){return Promise.resolve(o.el.renderView(e,t,r)).then(function(){})},function(e){console.error("render async view error",e)});return s&&s.then?s.then(c):c()}}();return Promise.resolve(a&&a.then?a.then(c):c(a))}catch(e){return Promise.reject(e)}},initRoute:function(e,t){try{var i=r(o),u=function(){if(n.isFunc(e.init))return Promise.resolve(e.init(t,i,o.el)).then(function(){})}();return Promise.resolve(u&&u.then?u.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},unmountRoute:function(e){e&&n.isFunc(e.unmount)&&e.unmount(r(o))},routeInit:function(e,t){try{var r=function(){if(s.routeInit&&n.isFunc(s.routeInit))return Promise.resolve(s.routeInit(e,t)).then(function(){})}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},navigate:function(t,r,u){try{if(!r&&o._currentPath&&o._currentPath===t)return Promise.resolve(!1);var c=o._currentPath;o._currentPath=t;var a={},f={},l=function(t,r){void 0===r&&(r={});try{var s=function(){function e(){function e(){var e=r.params,n=void 0===e?{}:e;u||o._listeners.forEach(function(e){e("pageChange",{from:c,to:o._currentRoute,params:n,query:a})})}var n=i(function(){return Promise.resolve(o.initRoute(f,l)).then(function(){})},function(e){console.error('Init route for "'+(f.name?f.name:t)+'" failed',e)});return n&&n.then?n.then(e):e()}var n=i(function(){return Promise.resolve(o.renderView(f.view,l,f.meta)).then(function(){})},function(e){console.error("Render view failed",e)});return n&&n.then?n.then(e):e()},f=h[t];f||(f=h["/notfound"]||{view:function(){return'<div class="page">404 Not Found</div>'}}),o._currentRoute=t,a=location.search.slice(1).split("&").reduce(function(e,n){var t=n.split("=");return e[t[0]]=decodeURIComponent(t[1]||""),e},{});var l=e({},o.getState(),r,{query:a,path:t}),d=function(){if(!u){var t=i(function(){return Promise.resolve(o.routeInit(f,l)).then(function(t){t&&!n.isEmptyObject(t)&&(l=e({},l,{routeState:t}))})},function(e){console.error("Pre-render failed:",e)});if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(d&&d.then?d.then(s):s())}catch(e){return Promise.reject(e)}},h=o.routes;if(u||o._currentRoute&&o.unmountRoute(o.routes[o._currentRoute]),h[t])return o._currentRoute=t,l(t),Promise.resolve({path:t,route:t,query:a,params:f});var d=t.split("/").slice(1),v=Object.keys(h).filter(function(e){return-1!==e.indexOf("/"+d[0])&&e.split("/").slice(1).length===d.length})[0];return v?(v.split("/").slice(2).forEach(function(e,n){f[e.slice(1)]=d[n+1]}),l(v,{params:f}),Promise.resolve({path:t,route:v,query:a,params:f})):(o._currentRoute=s.notFoundRouteName,l(s.notFoundUrl),Promise.resolve({path:t,route:void 0,query:a,params:f}))}catch(e){return Promise.reject(e)}},boot:function(){return Promise.resolve()}},u=function(e){try{return Promise.resolve(i(function(){function t(){return s.debug&&console.log("Initial app state",o._state),window.onpopstate=function(){try{return Promise.resolve(o.navigate(window.location.pathname)).then(function(){})}catch(e){return Promise.reject(e)}},o.global=s.global,window[s.global]=window[s.global]||{},window[s.global].navigate=function(e){try{return window.history.pushState({},e,window.location.origin+e),Promise.resolve(o.navigate(e)).then(function(){})}catch(e){return Promise.reject(e)}},window[s.global].dispatch=o.dispatch.bind(o),Promise.resolve(o.boot()).then(function(){return Promise.resolve(o.navigate(window.location.pathname)).then(function(){return o})})}if(n.isString(e)){if(o.el=document.querySelector(e),!o.el)throw new Error("Invalid mount target: "+e+". Missing from the DOM.")}else{if(!n.isNode(e)||!n.isElement(e))throw new Error("Invalid DOM object for mount.");o.el=e}var r=function(){if(n.isFunc(s.init))return Promise.resolve(s.init()).then(function(e){o._state=e});o._state=s.init||{}}();return r&&r.then?r.then(t):t()},function(e){return{ok:!1,error:e}}))}catch(e){return Promise.reject(e)}};return o.el=s.node||document.body,s.plugins&&n.isArray(s.plugins)&&s.plugins.forEach(function(e){o.plugin(e[0],e.length>1?e[1]:{})}),o.ctx=r(o),s.node&&(n.isElement(s.node)||n.isNode(s.node))?u(s.node):u(document.body)},s=Object.assign({},r,u),a={routes:{"/":function(){return{view:"<div>Webx Rocks!</div>"}},notfound:function(){return{view:"<div>404 Not Found!</div>"}},error:function(){return{view:"<div>An error has occurred!</div>"}}}},f=function(){if(!n.isEmptyObject(s.routes)){var e=function(){if(Object.keys(r).length)throw new Error("Invalid route configuration",r);a.routes=s.routes},r={},i=function(e,i,u){var c=[];for(var a in e)c.push(a);return function(e,n,r){var i,u,c=-1;return function r(s){try{for(;++c<e.length;)if((s=n(c))&&s.then){if(!((a=s)instanceof o&&1&a.s))return void s.then(r,u||(u=t.bind(null,i=new o,2)));s=s.v}i?t(i,1,s):i=s}catch(e){t(i||(i=new o),2,e)}var a}(),i}(c,function(e){return function(e){var t=function(){if(s.routes.hasOwnProperty(e)){var t=function(){o.view||(r[e]=['A view property is required for route "'+e+'"'])},o=s.routes[e],i=function(){if(n.isFunc(o))return Promise.resolve(o()).then(function(e){o=e})}();return i&&i.then?i.then(t):t()}}();if(t&&t.then)return t.then(function(){})}(c[e])})}(s.routes);return i&&i.then?i.then(e):e()}}();return Promise.resolve(f&&f.then?f.then(c):c())}catch(e){return Promise.reject(e)}}});
//# sourceMappingURL=webx1.umd.js.map
