!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).webx1=t()}(this,function(){function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var t={isString:function(e){return null!==e&&"string"==typeof e},isEmptyObject:function(e){var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},isFunc:function(e){return"function"==typeof e},isAsyncFunc:function(e){return t.isFunc(e)&&"AsyncFunction"===e.constructor.name},isNode:function(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},isElement:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}};function n(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}var r={global:"$",appName:"App",metaTitlePrepend:"",routes:{}};return function(o){try{var i=Object.assign({},r,o),u={routes:{"/":function(){return{view:"<div>Webx Rocks!</div>"}}}};if(!t.isEmptyObject(i.routes)){var s={};for(var c in i.routes)i.routes.hasOwnProperty(c)&&(i.routes[c].view||(s[c]=['A view property is required for route "'+c+'"']));if(Object.keys(s).length)throw new Error("Invalid route configuration",s);u.routes=i.routes}var a=function(e){return{setState:e.setState,getState:e.getState,dispatch:e.dispatch,refresh:e.refresh}},f={el:document.body,_currentPath:null,_currentRoute:null,_state:{},_listeners:[],_plugins:{},routes:e({},u.routes),ok:!0,getState:function(){var t=[].slice.call(arguments);return t.length?f._state[t[0]]:e({},f._state)},setState:function(e,t){var n=Object.freeze(JSON.parse(JSON.stringify(f._state)));f._state[e]=t;var r=Object.freeze(JSON.parse(JSON.stringify(f._state)));f._listeners.forEach(function(o){o("stateChange",r,n,e,t)})},replaceState:function(e){var t=Object.freeze(JSON.parse(JSON.stringify(f._state)));f._state=e,f._listeners.forEach(function(n){n("stateChange",e,t,"*",e)})},dispatch:function(e){var t=arguments;f._listeners.forEach(function(n){n.apply(null,[e].concat([].slice.call(t,1)))})},listen:function(e){t.isFunc(e)?f._listeners.push(e):console.error("Listen handler must be a function",e)},refresh:function(){f.navigate(f._currentPath,!0)},renderView:function(e,r,o){try{var u,s=function(s){if(u)return s;function c(){o&&(document.title=""+i.metaTitlePrepend+o.title)}var a=function(){if(t.isAsyncFunc(e)){var o=n(function(){return Promise.resolve(e(r)).then(function(e){f.el.innerHTML=e})},function(e){console.error("Render view errror",e)});if(o&&o.then)return o.then(function(){})}else f.el.innerHTML=e(r)}();return a&&a.then?a.then(c):c()};if(!t.isFunc(e))throw new Error("renderView requires a function.");var c=function(){if(f.el.renderView&&t.isFunc(f.el.renderView)){var i=function(){u=1},s=function(){if(t.isAsyncFunc(f.el.renderView)){var i=n(function(){return Promise.resolve(f.el.renderView(e,r,o)).then(function(){})},function(e){console.error("render async view error",e)});if(i&&i.then)return i.then(function(){})}else f.el.renderView(e,r,o)}();return s&&s.then?s.then(i):i()}}();return Promise.resolve(c&&c.then?c.then(s):s(c))}catch(e){return Promise.reject(e)}},initRoute:function(e,n){try{var r=a(f),o=function(){if(t.isFunc(e.init)){var o=function(){if(t.isAsyncFunc(e.init))return Promise.resolve(e.init(n,r,f.el)).then(function(){});e.init(n,r,f.el)}();if(o&&o.then)return o.then(function(){})}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},unmountRoute:function(e){e&&t.isFunc(e.unmount)&&e.unmount(a(f))},navigate:function(t,r){try{if(!r&&f._currentPath&&f._currentPath===t)return Promise.resolve(!1);var o=f._currentPath;f._currentPath=t;var i={},u={},s=function(t,r){void 0===r&&(r={});try{var u=function(){return Promise.resolve(f.initRoute(s,a)).then(function(){var e=r.params,t=void 0===e?{}:e;f._listeners.forEach(function(e){e("pageChange",{from:o,to:f._currentRoute,params:t,query:i})})})},s=c[t];s||(s=c["/notfound"]||{view:function(){return'<div class="page">404 Not Found</div>'}}),f._currentRoute=t,i=location.search.slice(1).split("&").reduce(function(e,t){var n=t.split("=");return e[n[0]]=decodeURIComponent(n[1]||""),e},{});var a=e({},f.getState(),r,{query:i,path:t}),l=n(function(){return Promise.resolve(f.renderView(s.view,a,s.meta)).then(function(){})},function(e){console.error(e)});return Promise.resolve(l&&l.then?l.then(u):u())}catch(e){return Promise.reject(e)}},c=f.routes;if(f._currentRoute&&f.unmountRoute(f.routes[f._currentRoute]),c[t])return f._currentRoute=t,s(t),Promise.resolve({path:t,route:t,query:i,params:u});var a=t.split("/").slice(1),l=Object.keys(c).filter(function(e){return-1!==e.indexOf("/"+a[0])&&e.split("/").slice(1).length===a.length})[0];return l?(l.split("/").slice(2).forEach(function(e,t){u[e.slice(1)]=a[t+1]}),s(l,{params:u}),Promise.resolve({path:t,route:l,query:i,params:u})):(f._currentRoute="notfound",s("/notfound"),Promise.resolve({path:t,route:void 0,query:i,params:u}))}catch(e){return Promise.reject(e)}},boot:function(){return Promise.resolve()}},l={use:function(e,n){if(void 0===n&&(n={}),!e.name)throw new Error("A plugin must have a name property.");if(!e.install||!t.isFunc(e.install))throw new Error("A plugin must define an install method.");if(f._plugins[e.name])throw new Error('A plugin with the name: "'+e.name+' is already registered."');f._plugins[e.name]=e;try{e.install(f,n)}catch(t){console.error('Plugin "'+e.name+'" failed to install.',t),delete f._plugins[e.name]}return l},mount:function(e){try{return Promise.resolve(n(function(){function n(){return i.debug&&console.log("Initial app state",f._state),window.onpopstate=function(){try{return Promise.resolve(f.navigate(window.location.pathname)).then(function(){})}catch(e){return Promise.reject(e)}},window[i.global]=window[i.global]||{},window[i.global].navigate=function(e){try{return window.history.pushState({},e,window.location.origin+e),Promise.resolve(f.navigate(e)).then(function(){})}catch(e){return Promise.reject(e)}},window[i.global].dispatch=f.dispatch.bind(f),Promise.resolve(f.boot()).then(function(){return Promise.resolve(f.navigate(window.location.pathname)).then(function(){return f})})}if(t.isString(e)){if(f.el=document.querySelector(e),!f.el)throw new Error("Invalid mount target: "+e+". Missing from the DOM.")}else{if(!t.isNode(e)||!t.isElement(e))throw new Error("Invalid DOM object for mount.");f.el=e}var r=function(){if(t.isFunc(i.init)){var e=function(e){f._state=e};return t.isAsyncFunc(i.init)?Promise.resolve(i.init()).then(e):e(i.init())}f._state=i.init||{}}();return r&&r.then?r.then(n):n()},function(e){return{ok:!1,error:e}}))}catch(e){return Promise.reject(e)}}};return Promise.resolve(l)}catch(e){return Promise.reject(e)}}});
//# sourceMappingURL=webx1.umd.js.map
